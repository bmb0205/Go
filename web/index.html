<!DOCTYPE html>
<html>
	<head>
		<title>Project Uno</title>
		<link href="custom.css" type="text/css" rel="stylesheet">
		<script src="jquery-1.12.3.min.js"></script>
	</head>
	<body>
		<form class="form-inline">
			<input type="text" name="getTimerName()" id="myTimer">
			<button id="myButton" type="button" value="" onclick="startTimer()">Start!</button><br>
			<div id="timerName">Timer name: </div>
			<div id="holder">Total accumulated time in seconds: 0 </div>
			<label for="myTimer" class="timerDisplay">Current active timer: 0.000</label>
		</form>

		<script>
		setTimeout(updateStatus, 1000);

		interval = 1000;
		function updateStatus() {
			$.ajax({
				url: "/status",
				data: {timerName: $("#myTimer").val()},
				dataType: "json",
				type: "GET",
				success: function (data) {
					$("#holder").html("Total accumulated time in seconds: " + data.totaltime);
					var runningTime = (new Date - startTime) / 1000
					$('.timerDisplay').text('Current active timer: ' + runningTime);
				// 	$("#holder").html(data.timerName);
				// },
				// complete: function(data) {
				// 	setTimeout(updateStatus, interval);
				}
			}).done(function(data) {
				// $("#holder").html("Total accumulated time in seconds: " + data.totaltime);
				// var runningTime = (new Date - startTime) / 1000
				// $('.timerDisplay').text('Current active timer: ' + runningTime);
			});
			setTimeout(updateStatus, interval);
		}
		function startTimer() {
			$("#myButton").html("Stop!");
			$("#timerName").html("Timer name: " + $("#myTimer").val());
			var startTime = new Date;
			// timeout = setTimeout(updateStatus, interval);
			// updateStatus();
			var timerId = setInterval(function() {
				$('.timerDisplay').text("Current active timer: " + (new Date - startTime) / 1000);
			}, 50);
			document.getElementById("myButton").onclick = function() { stopTimer(timerId); };
			$.ajax({
				url: "/start",
				data: JSON.stringify({timerName: $("#myTimer").val(), startTime: startTime, isNew: false}),
				dataType: "json",
				type: "POST"
			}).done(function(data) {
				// alert("POST request start endpoint hit");
				// alert(JSON.stringify(data));
				// alert(data.timername);
				// alert(data.startTime);

			});
		}

		function stopTimer(timerId) {
			var stopTime = new Date;
			$.ajax({
				url: "/stop",
				data: JSON.stringify({timername: $("#myTimer").val(), stopTime: stopTime}),
				dataType: "json",
				type: "POST"
			}).done(function(data) {
				// alert("POST request stop endpoint hit");
				// alert(JSON.stringify(data));
				// alert(data.timername);
				// alert(data.stopTime);
			});
			// alert($(".timerDisplay").text());
			clearInterval(timerId);
			// clearTimeout(timeout);
			$(".timerDisplay").text("Current active timer: 0.000");
			document.getElementById("myButton").onclick = startTimer;
			$("#myButton").html("Start!");
		}
		
		</script>
	</body>
</html>
